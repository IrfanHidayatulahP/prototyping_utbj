<%- include('../partials/header.ejs') %>

    <style>
        /* ===============================
   GLOBAL DASHBOARD LAYOUT FIX
   =============================== */
        body {
            background: #e6e6e6;
            font-family: 'Inter', sans-serif;
        }

        /* area kanan sidebar */
        .dashboard-page {
            width: 100%;
            min-height: 100vh;
        }

        /* wrapper konten */
        .dashboard-wrapper {
            max-width: 1400px;
            width: 100%;
            margin: 0 auto;
            padding: 32px 40px;
        }

        /* ===============================
   TITLE & SECTION
   =============================== */
        .page-title {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 24px;
        }

        .section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 16px;
            border-bottom: 1px solid #999;
            padding-bottom: 8px;
        }

        /* ===============================
   OVERVIEW
   =============================== */
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(280px, 1fr));
            gap: 24px;
        }

        .overview-card {
            background: #faf7ff;
            border-radius: 12px;
            padding: 20px 24px;
        }

        .overview-card:first-child {
            border: 2px dashed #8b5cf6;
        }

        .overview-card h4 {
            font-size: 15px;
            margin-bottom: 6px;
        }

        .overview-card p {
            font-size: 14px;
            color: #555;
        }

        /* ===============================
   DEADLINE SECTION
   =============================== */
        .deadline-layout {
            display: grid;
            grid-template-columns: 1.4fr 1fr;
            gap: 56px;
            align-items: flex-start;
        }

        /* LIST */
        .deadline-list {
            width: 100%;
        }

        .deadline-card {
            display: flex;
            align-items: center;
            background: #faf7ff;
            padding: 14px 18px;
            border-radius: 14px;
            margin-bottom: 14px;
        }

        .deadline-avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: #e9d5ff;
            color: #6b21a8;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 14px;
        }

        .deadline-info {
            flex: 1;
        }

        .deadline-type {
            font-size: 12px;
            color: #777;
            display: block;
        }

        .deadline-days {
            font-size: 13px;
            color: #555;
            white-space: nowrap;
        }

        /* ===============================
   CALENDAR
   =============================== */
        .calendar-container {
            width: 100%;
            max-width: 360px;
            background: #1f1f1f;
            border-radius: 18px;
            padding: 18px;
            color: #fff;
            justify-self: center;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 14px;
        }

        .calendar-header button {
            background: none;
            border: none;
            color: #fff;
            font-size: 18px;
            cursor: pointer;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            text-align: center;
        }

        .day-name {
            font-size: 11px;
            opacity: 0.6;
        }

        .calendar-day {
            padding: 8px 0;
            border-radius: 8px;
            font-size: 13px;
        }

        .calendar-day.today {
            background: #fff;
            color: #000;
            font-weight: 600;
        }

        .calendar-day.other {
            opacity: 0.2;
        }

        .empty {
            color: #777;
            font-size: 14px;
        }

        /* ===============================
   RESPONSIVE
   =============================== */
        @media (max-width: 1024px) {
            .deadline-layout {
                grid-template-columns: 1fr;
            }

            .calendar-container {
                margin-top: 24px;
            }
        }
    </style>

    <div class="dashboard-page">
        <div class="dashboard-wrapper">
            <h1 class="page-title">Dashboard</h1>

            <!-- OVERVIEW -->
            <div class="section">
                <h3 class="section-title">Overview</h3>

                <div class="overview-grid">
                    <div class="overview-card">
                        <h4>Beban Proposal</h4>
                        <p>
                            <%= stats?.toReview || 0 %> Proposal
                        </p>
                    </div>

                    <div class="overview-card">
                        <h4>Total Review Proposal</h4>
                        <p>
                            <%= stats?.reviewedThisMonth || 0 %> Proposal
                        </p>
                    </div>
                </div>
            </div>

            <!-- DEADLINE -->
            <div class="section">
                <h3 class="section-title">Overview (Deadline)</h3>

                <div class="deadline-layout">
                    <!-- LIST -->
                    <div class="deadline-list">
                        <% if (queue && queue.length) { %>
                            <% queue.forEach(item=> { %>
                                <div class="deadline-card">
                                    <div class="deadline-avatar">
                                        <%= item.title.charAt(0).toUpperCase() %>
                                    </div>

                                    <div class="deadline-info">
                                        <span class="deadline-type">Review Proposal</span>
                                        <strong>
                                            <%= item.title %>
                                        </strong>
                                    </div>

                                    <div class="deadline-days" data-deadline="<%= item.deadline %>"></div>
                                </div>
                                <% }) %>
                                    <% } else { %>
                                        <p class="empty">Tidak ada deadline</p>
                                        <% } %>
                    </div>

                    <!-- CALENDAR -->
                    <div class="calendar-container">
                        <div class="calendar-header">
                            <button id="prevMonth">‹</button>
                            <div>
                                <span id="monthLabel"></span>
                                <span id="yearLabel"></span>
                            </div>
                            <button id="nextMonth">›</button>
                        </div>

                        <div class="calendar-grid">
                            <div class="day-name">Su</div>
                            <div class="day-name">Mo</div>
                            <div class="day-name">Tu</div>
                            <div class="day-name">We</div>
                            <div class="day-name">Th</div>
                            <div class="day-name">Fr</div>
                            <div class="day-name">Sa</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        /* =============================
           DEADLINE DAYS LEFT
        ============================= */
        document.querySelectorAll('.deadline-days').forEach(el => {
            const deadline = new Date(el.dataset.deadline);
            const today = new Date();
            const diff = Math.ceil((deadline - today) / (1000 * 60 * 60 * 24));
            el.innerText = diff > 0 ? `${diff} Days Left` : 'Expired';
        });

        /* =============================
           CALENDAR
        ============================= */
        const monthLabel = document.getElementById('monthLabel');
        const yearLabel = document.getElementById('yearLabel');
        const grid = document.querySelector('.calendar-grid');

        let currentDate = new Date();

        function renderCalendar(date) {
            const year = date.getFullYear();
            const month = date.getMonth();

            monthLabel.innerText = date.toLocaleString('en', { month: 'short' });
            yearLabel.innerText = year;

            grid.querySelectorAll('.calendar-day').forEach(e => e.remove());

            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            const today = new Date();

            for (let i = 0; i < firstDay; i++) {
                grid.insertAdjacentHTML('beforeend', `<div class="calendar-day other"></div>`);
            }

            for (let d = 1; d <= lastDate; d++) {
                const isToday =
                    d === today.getDate() &&
                    month === today.getMonth() &&
                    year === today.getFullYear();

                grid.insertAdjacentHTML(
                    'beforeend',
                    `<div class="calendar-day ${isToday ? 'today' : ''}">${d}</div>`
                );
            }
        }

        renderCalendar(currentDate);

        document.getElementById('prevMonth').onclick = () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar(currentDate);
        };

        document.getElementById('nextMonth').onclick = () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar(currentDate);
        };
    </script>

    <%- include('../partials/footer.ejs') %>